//
// backbone.stickit v0.5.0
//
// The MIT License
// Copyright (c) 2012 The New York Times, CMS Group, Matthew DeLambo <delambo@gmail.com>
//
(function(r){var n,l,o,p;_.extend(Backbone.View.prototype,{_modelBindings:[],unstickModel:function(){_.each(this._modelBindings,function(b){b.model.off(b.event,b.fn)});this._modelBindings=[]},stickit:function(b,a){var c=this,g,f=b||this.model,d=a||this.bindings||{};this.events||(this.events={});g=function(a,b){f.on(a,b,c);c._modelBindings.push({model:f,event:a,fn:b})};_.each(_.keys(d),function(a){var b,j,h=d[a]||{},e=c.$(a),q=h.format,i=h.modelAttr,s=h.attributes||[];if(!e.length)return!1;b=function(a){a=
h.escape?f.escape(a):f.get(a);_.isUndefined(a)&&(a="");return q?l(c,q,a):a};_.each(s,function(a){var b="",d=function(){var d=l(c,a.format)||f.get(i);a.name=="class"?(e.removeClass(b).addClass(d),b=d):e.attr(a.name,d)};g("bind:"+(a.observe||i),d);d()});if(i){if(e.is("input[type=radio]")||e.is("input[type=checkbox]")||e.is("select"))j="change";else if(e.is("input")||e.is("textarea"))j="keyup";j&&(c.events[j+" "+a]=function(){f.set(i,p(e),h.setOptions)});g("bind:"+i,function(){o(c,e,h,b(i))});o(c,e,
h,b(i),!0)}});this.delegateEvents();this.remove=_.wrap(this.remove,function(a){c.unstickModel();a&&a.call(c)})}});Backbone.Model.prototype.set=_.wrap(Backbone.Model.prototype.set,function(b,a,c,g){var f,d=g&&_.clone(g)||{},k=this.attributes;_.isObject(a)||a==null?(f=a,d=c):(f={},f[a]=c);d||(d={});b=b.call(this,f,d);_.each(_.keys(f),_.bind(function(a){(d.bind!==!1||!_.isEqual(k[a],void 0)||d.unset&&_.has(k,a))&&this.trigger("bind:"+a,f[a])},this));return b});n=function(b,a){var c=(a||"").split(".");
return _.reduce(c,function(a,b){return a[b]},b)||b};l=function(b,a){if(a)return(_.isString(a)?b[a]:a).apply(b,_.toArray(arguments).slice(2))};p=function(b){return b.is("input[type=checkbox]")?b.prop("checked"):b.is("select")?b.find("option:selected").data("stickit_bind_val"):b.val()};o=function(b,a,c,g,f){var d,k=c.modelAttr,m=c.readonly,j=c.afterUpdate,h=c.selectOptions;d=c.updateMethod||"text";c=function(){m?_.isBoolean(m)?a.prop("readonly",m):a.prop("readonly",b[m].call(b,k)):a.prop("readonly",
!1)};if(a.is("input[type=radio]"))a.filter("[value="+g+"]").prop("checked",!0),c();else if(a.is("input[type=checkbox]"))a.prop("checked",g===!0),c();else if(a.is("input")||a.is("textarea"))d=a.val(),d!=g&&a.val(g),c();else if(a.is("select")){d=h.collection;var e=model.get(k);a.html("");d=_.isFunction(d)?d.call(b):n(window,d);e==null&&a.append("<option/>").find("option").prop("selected",!0).data("stickit_bind_val",e);_.each(d,function(b){var d=r("<option/>"),c=b;b!=null&&(d.text(b[h.labelPath]),c=
n(b,h.valuePath));d.data("stickit_bind_val",c);(c!=null&&e!=null&&c==e||_.isObject(e)&&_.isEqual(c,e))&&d.prop("selected",!0);a.append(d)});c()}else a[d](g);f||l(b,j,a,g)}})(window.jQuery||window.Zepto);
